---
name: "Check group membership of workflow dispatcher"

on:
  workflow_dispatch:
    inputs:
      team-slug:
        description: team slug (get from url)

jobs:
  check-membership:
    runs-on: ubuntu-latest
    steps:
    - id: get-all-members
      run: |
        echo "checking if ${{ github.actor }} is in ${TEAM_SLUG}"
        members=$(gh api --paginate -X GET /orgs/$ORG_SLUG/teams/$TEAM_SLUG/members\?role=$ROLE | jq 'reduce inputs as $i (.; . += $i)|[.[].login]')
        echo "$members" | jq -e 'any(. == "${{ github.actor }}")'
      env:
        ORG_SLUG: OpenSesame
        TEAM_SLUG: ${{ inputs.team-slug }}
        GH_TOKEN: ${{ secrets.ORG_READ_TOKEN }}
